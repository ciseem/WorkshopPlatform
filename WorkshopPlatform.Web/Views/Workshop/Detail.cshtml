@model WorkshopPlatform.Core.Entities.Workshop
@functions {
    string GetWorkshopImage(string kategori) {
        return kategori switch {
            "YazÄ±lÄ±m" => "/images/software.png",
            "TasarÄ±m" => "/images/design.png",
            "Ä°ÅŸletme" => "/images/business.png",
            "Pazarlama" => "/images/marketing.png",
            _ => "https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=1200&q=80"
        };
    }
}

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 4rem; align-items: start;">
    <div>
        <div style="position: relative; margin-bottom: 2.5rem; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-md); border: 1px solid var(--gray-200);">
            <img src="@GetWorkshopImage(Model.Kategori)" style="width: 100%; height: 450px; object-fit: cover;">
            <div style="position: absolute; top: 1.5rem; left: 1.5rem;">
                <span class="badge" style="background: var(--primary); color: white; padding: 0.5rem 1rem;">
                    @Model.Kategori
                </span>
            </div>
        </div>
        
        <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
            <div style="background: var(--gray-100); border: 1px solid var(--gray-200); padding: 0.75rem 1.5rem; border-radius: 12px;">
                <div style="font-size: 0.65rem; font-weight: 700; color: var(--secondary); text-transform: uppercase; margin-bottom: 0.25rem;">EÄŸitim Ãœcreti</div>
                <div style="font-size: 1.5rem; font-weight: 800; color: var(--primary);">
                    @(Model.UcretliMi ? $"{Model.Fiyat:C2}" : "Ãœcretsiz")
                </div>
            </div>
        </div>
 
        <h1 style="font-size: 2.5rem; font-weight: 800; color: var(--dark); margin-bottom: 1.5rem; line-height: 1.2;">@Model.Baslik</h1>
        
        <div style="font-size: 1.1rem; line-height: 1.7; color: var(--secondary); margin-bottom: 3rem; text-align: justify;">
            @Model.Aciklama
        </div>

        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--dark);">EÄŸitmen Bilgisi</h3>
        <div class="premium-card" style="display: flex; align-items: center; gap: 2rem; padding: 2rem; background: #fff; border-radius: 16px;">
            <div style="width: 72px; height: 72px; background: var(--gray-100); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1.5rem; font-weight: 800; border: 1px solid var(--gray-200);">
                @(Model.OlusturanKullanici?.AdSoyad?.Substring(0, 1) ?? "E")
            </div>
            <div>
                <div style="font-weight: 800; font-size: 1.25rem; color: var(--dark);">@(Model.OlusturanKullanici?.AdSoyad ?? "EÄŸitmen")</div>
                <div style="color: var(--primary); font-size: 0.8rem; font-weight: 700; text-transform: uppercase; margin-top: 0.25rem;">Yetkili EÄŸitmen</div>
                <p style="margin-top: 0.5rem; color: var(--secondary); font-size: 0.9rem; line-height: 1.5;">UzmanlÄ±k alanÄ±nda profesyonel tecrÃ¼be ile hazÄ±rlanan eÄŸitim iÃ§eriÄŸi.</p>
            </div>
        </div>
    </div>

    <div style="position: sticky; top: 2.5rem;">
        <div class="premium-card" style="padding: 2.5rem; border-radius: 20px;">
            <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--dark); text-align: center;">MÃ¼sait Seanslar</h3>
            
            @if (TempData["Message"] != null)
            {
                <div style="padding: 1rem; background: #ecfdf5; color: #166534; border-radius: 8px; font-size: 0.875rem; font-weight: 600; margin-bottom: 1.5rem; border: 1px solid #dcfce7; text-align: center;">
                    <i class="fas fa-check-circle" style="margin-right: 0.5rem;"></i> @TempData["Message"]
                </div>
            }

            <!-- Location Section âš“ðŸ—ºï¸ -->
            @if (!string.IsNullOrEmpty(Model.Sehir))
            {
                <div class="premium-card mb-8" style="margin-bottom: 2rem;">
                    <h5 class="font-bold mb-4" style="color: var(--dark); font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem;"><i class="fas fa-map-marker-alt" style="color: var(--primary); margin-right: 0.5rem;"></i> Etkinlik Konumu</h5>
                    <div class="flex flex-wrap gap-4 mb-4" style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
                        <div class="stat-item bg-gray-50 rounded p-3 flex-1 border" style="background: var(--gray-50); border-radius: 8px; padding: 0.75rem; flex: 1; border: 1px solid var(--gray-200);">
                            <span class="stat-label" style="font-size: 0.75rem; color: var(--secondary);">Åžehir / Ä°lÃ§e</span>
                            <span class="font-bold text-dark" style="font-weight: 700; color: var(--dark); display: block;">@Model.Sehir, @Model.Ilce</span>
                        </div>
                        <div class="stat-item bg-gray-50 rounded p-3 flex-1 border" style="background: var(--gray-50); border-radius: 8px; padding: 0.75rem; flex: 1; border: 1px solid var(--gray-200);">
                            <span class="stat-label" style="font-size: 0.75rem; color: var(--secondary);">Mekan</span>
                            <span class="font-bold text-dark" style="font-weight: 700; color: var(--dark); display: block;">@Model.MekanAd</span>
                        </div>
                    </div>

                    @if (Model.Enlem.HasValue && Model.Boylam.HasValue)
                    {
                        <div id="detailMap" style="height: 250px; border-radius: 12px; border: 1px solid var(--gray-200);"></div>
                    }
                </div>
            }

            <div class="premium-card">
                <h5 class="font-bold mb-4" style="color: var(--dark); font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem;">Uygulama SeanslarÄ±</h5>
                <div class="space-y-4" style="display: flex; flex-direction: column; gap: 1rem;">
                    @if (Model.Seanslar != null)
                    {
                        @foreach (var seans in Model.Seanslar)
                        {
                            <div style="background: var(--gray-50); border: 1px solid var(--gray-200); padding: 1rem; border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <p class="mb-0 font-bold" style="color: var(--dark); font-weight: 700; margin-bottom: 0;">@seans.Tarih.ToString("dd MMMM yyyy")</p>
                                    <p class="mb-0 text-secondary" style="font-size: 0.85rem; color: var(--secondary); margin-bottom: 0;">@seans.Saat.ToString(@"hh\:mm") | Kontenjan: @seans.KalanKontenjan/@seans.Kontenjan</p>
                                </div>
                                @if (seans.KalanKontenjan > 0)
                                {
                                    <form asp-action="Join" method="post">
                                        <input type="hidden" name="seansId" value="@seans.Id" />
                                        <button type="submit" class="premium-btn-sm" style="font-size: 0.75rem; padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">KayÄ±t Ol</button>
                                    </form>
                                }
                                else
                                {
                                    <button class="btn btn-secondary btn-sm" disabled style="border-radius: 8px; font-size: 0.75rem; background: var(--gray-300); color: var(--gray-600); border: none; padding: 0.5rem 1rem; cursor: not-allowed;">Dolu</button>
                                }
                            </div>
                        }
                    }
                </div>
            </div>
            
            <p style="margin-top: 1.5rem; text-align: center; font-size: 0.75rem; color: var(--secondary); font-weight: 500;">
                <i class="fas fa-lock" style="margin-right: 0.25rem;"></i> GÃ¼venli KayÄ±t Sistemi
            </p>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.Sehir) && Model.Enlem.HasValue && Model.Boylam.HasValue)
{
    @section Scripts {
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script>
            var lat = @(Model.Enlem.Value.ToString(System.Globalization.CultureInfo.InvariantCulture));
            var lng = @(Model.Boylam.Value.ToString(System.Globalization.CultureInfo.InvariantCulture));
            var map = L.map('detailMap').setView([lat, lng], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);

            L.marker([lat, lng]).addTo(map)
                .bindPopup("<b>@Model.MekanAd</b><br>@Model.Ilce, @Model.Sehir")
                .openPopup();
        </script>
    }
}
